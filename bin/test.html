<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />

<link href="../css/bootstrap-theme.min.css" rel="stylesheet">
<!-- Prism -->
<link href="../css/prism.css" rel="stylesheet">

<link href="../css/footable.bootstrap.min.css" rel="stylesheet">
<link href="../css/ladda-themeless.css" rel="stylesheet">
<link href="../css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="../css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="../css/animate.css" type="text/css" />
<link rel="stylesheet" href="../css/simple-line-icons.css" type="text/css" />
<link rel="stylesheet" href="../css/font.css" type="text/css" />
<link rel="stylesheet" href="../css/app.css" type="text/css" />
<link rel="stylesheet" href="../css/public.css" type="text/css" />
<link rel="stylesheet" href="../css/bootstrap-treeview.min.css" type="text/css" />
<link rel="stylesheet" href="../css/font-awesome.min.css" type="text/css" />
</head>
<body>

<!--[if lt IE 9]>
<script src="../js/html5shiv.min.js"></script>
<script src="../js/respond.min.js"></script>
<![endif]-->
<style type="text/css">
    .bd{ border: 1px solid #ccc}
    #view1rtn{border: 1px solid #ccc; padding: 2px 18px;position:absolute;z-index:100; top:25px; cursor: pointer}
    .source{ width: 100%}

    .modal-backdrop {  opacity: 0 !important;  filter: alpha(opacity=0) !important;  }
    .center-block{  display:block;  margin-left:auto;  margin-right:auto;  }
    th,td{ border: 1px solid darkgray; background-color: white; height: auto; min-height: 30px}
    li{ height: 30px; border: 1px;}

    .key-add{color:#5cb85c}
    .key-del{color:red}
    .key-edit{color:#31b0d5}
    tr>td>div.newParent>span.badge{color:#5cb85c; cursor: pointer}
    div.treeview>ul>li>span.badge:nth-last-child(1){color:#5cb85c }
    div.treeview>ul>li>span.badge:nth-last-child(2){color:red }
    div.treeview>ul>li>span.badge:nth-last-child(3){color:#31b0d5 }


    th{ text-align: center; height: 30px}
    tr td{ min-width: 40px; }
    tr td:first-child{ text-align: center;}
    tr td.treeview{text-align: left}
    .hide{display: none}
    .td_value{ width: 100%; border:1px solid #ccc; height:30px; padding-top:10px;text-align: center  }
    .newParent{padding-bottom: 8px; margin-top: 10px; padding-left: 38px;}



</style>
<div CLASS="test1">1234567890</div>
<div CLASS="test1">1234567890</div>
<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
    开始演示模态框
</button>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    模态框（Modal）标题
                </h4>
            </div>
            <div class="modal-body">
                在这里添加一些文本
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary">
                    提交更改
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


data-editing-add-text="New row"


<div id="tree1" style="width: 90%; height: 400px; border: 1px solid #ccc; margin: 5%">



</div>

<table class="table">

</table>


<script src="../js/jquery-3.0.0.min.js"></script>
<script src="../js/echarts.min.js"></script>
<script src="../js/bootstrap-3.3.7.min.js"></script>
<script src="../js/bootstrap-treeview.min.js"></script>
<script src="../js/public.js"></script>
<script src="../js/prism.js"></script>
<script src="../js/ie10-viewport-bug-workaround.js"></script>
<script src="../js/moment.min.js"></script>
<script src="../js/footable.min.js"></script>
<script src="../js/spin.js"></script>
<script src="../js/ladda.js"></script>
<script src="../js/ejs.js"></script>
<script src="../js/com_tree.js?v=1.3"></script>


</body>
</html>

<script language="javascript">
    "use strict";

    $(document).ready(function() {

        FooTable.init(".table", {
            "columns": [
                { "name": "id", "title": "ID", "breakpoints": "xs" },
                { "name": "firstName", "title": "First Name" },
                { "name": "lastName", "title": "Last Name" },
                { "name": "jobTitle", "title": "Job Title", "breakpoints": "xs" },
                { "name": "started", "title": "Started On", "breakpoints": "xs sm" },
                { "name": "dob", "title": "DOB", "breakpoints": "xs sm md" }
            ],
            "rows": [
                {
                    "options": {
                        "expanded": true
                    },
                    "value": { "id": 1, "firstName": "Dennise", "lastName": "Fuhrman", "jobTitle": "High School History Teacher", "started": "November 8th 2011", "dob": "July 25th 1960" }
                },
                { "id": 2, "firstName": "Elodia", "lastName": "Weisz", "jobTitle": "Wallpaperer Helper", "started": "October 15th 2010", "dob": "March 30th 1982" },
                { "id": 3, "firstName": "Raeann", "lastName": "Haner", "jobTitle": "Internal Medicine Nurse Practitioner", "started": "November 28th 2013", "dob": "February 26th 1966" },
                { "id": 4, "firstName": "Junie", "lastName": "Landa", "jobTitle": "Offbearer", "started": "October 31st 2010", "dob": "March 29th 1966" },
                { "id": 5, "firstName": "Solomon", "lastName": "Bittinger", "jobTitle": "Roller Skater", "started": "December 29th 2011", "dob": "September 22nd 1964" },
                { "id": 6, "firstName": "Bar", "lastName": "Lewis", "jobTitle": "Clown", "started": "November 12th 2012", "dob": "August 4th 1991" },
                { "id": 7, "firstName": "Usha", "lastName": "Leak", "jobTitle": "Ships Electronic Warfare Officer", "started": "August 14th 2012", "dob": "November 20th 1979" },
                { "id": 8, "firstName": "Lorriane", "lastName": "Cooke", "jobTitle": "Technical Services Librarian", "started": "September 21st 2010", "dob": "April 7th 1969" }
            ]
        });

        DrawPieTree();


        function DrawPieTree(dt){
            var data = dt || {name:"绩效", nodes:[{name:"直达", value:20, nodes:[{name:"直达1", value:30}, {name:"直达2", value:70}]},
                {name:"营销广告", value:10},
                {name:"搜索引擎", value:60, nodes:[{name:"邮件", value:35, nodes:[{name:"企业邮件", value:15}]}, {name:"联盟", value:65}]}] };

            var colorCfg = ["#87CEFA", "#58C1C0", "#23BAD7", "#F7A35C", "#8085E9", "#10B4E8", "#07C25B",
                "#89F588", "#12AA9E", "#9C99FF", "#4F81BE", "#279F3E", "#FD5F60", "#F7DDDC",
                "#4272C6", "#FF850A", "#8DAE00", "#67C454", "#F25C82", "#DC70D6"];
            var colorNull = "#ddd";

            // 获取一个相似颜色， 十六进制，layer表示哪个颜色做改动
            function getColorNear(clr, layer){
                if(layer==undefined) layer = 0;
                layer = layer % 3;
                var r = clr.substr(1, 2), g = clr.substr(3, 2), b = clr.substr(5, 2);
                var c = [r, g, b], number = parseInt(c[layer], 16), f = [-1, 1][parseInt(Math.random() * 2)],
                        offset = parseInt(Math.random() * 32) * f;
                var S = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
                number = (number + offset) % 256;
                c[layer] = S[parseInt(number / 16)] + S[parseInt(number % 16)];
                return "#" + c[0] + c[1] + c[2];
            }

            var T = new ViewTree(), height = ViewTree.getTreeHeight(data), rCenter = 0;
            var series = [], R = 85 / (height - 1);
            for(var i = 1; i< height; i++) series.push({
                data:[],
                type:"pie",
                radius: [(R * (i - 1) + rCenter) + "%", (R * i + rCenter) + '%'],
                label: {
                    normal: {
                        position: 'inner'
                    }
                },
                labelLine: {
                    normal: {
                        show: false
                    }
                }
            });

            T.viewTreeByLayer(data, function(n){
                if("nodes" in n){   // 检查是否配满
                    var sumC = n["nodes"].reduce(function(a, b){ a += b.value; return a; }, 0);
                    if(sumC<100)n["nodes"].push({name:"empty", value:100 - sumC, height:n.height + 1 });
                }else{
                    if(n.height > 0 && n.height < (height-1)){  // 空子孙占位
                        n["nodes"] = [{name: n.name, value: 100, flag:'full', height:n.height + 1 }];
                    }
                }
            });

            // 一级节点配色
            data['nodes'].forEach(function(d, i){
                d['color'] = (d.name==="empty") ? colorNull : colorCfg[i % 20];
            });

            // 节点配色
            T.viewTreeByLayer(data, function(n){
                if(n.height==0 || !("nodes" in n))return;
                n.nodes.forEach(function(c){
                    if(c.name=='empty') c['color'] = "#ddd";             //空白色
                    else if(c.flag=='full') c['color'] = n.color;       //子级占位同色
                    else c['color'] = getColorNear(n.color, n.height);  //子孙近似色
                });
            });


            data['id'] = "root";
            ViewTree.getLeafWeight(data);       // 获取各级最终比例

            T.viewTreeByLayer(data, function(node){
                if(node.height != 0) series[node.height - 1].data.push({
                        name: node.name==="empty" ? "空" : node.name,
                        value: (node.value * 100).toFixed(2),
                        itemStyle: {normal:{color:node.color }
                        }});
            });

            var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: function(p){ return p.name + "<br>所占比例：" + p.value; }
                },
                series: series
            };

            Init3(option, "tree1");
        }
        // End Function

    });








































</script>